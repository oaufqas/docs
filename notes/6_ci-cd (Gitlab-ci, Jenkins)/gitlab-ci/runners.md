Gitlab - заказчик, runner - работник, исполняющий заказы, в нашем случае команды из .gitlab-ci.yml

Когда Runner получает задание. Ему нужно решить, где и как выполнять команды вроде npm test или docker build. За это отвечает компонент под названием executor. Executor — это стратегия или "движок", который создает изолированную среду для каждого задания. Ты выбираешь executor при регистрации раннера. Вот основные варианты:


Shell - Команды выполняются прямо на машине, где установлен Runner, в обычной командной оболочке (bash, powershell) . Уровень изоляции низкий (задания влияют друг на друга и на хост). Самые простые скрипты, когда не хочется заморачиваться с контейнерами. Не подходит для безопасности, если проекты не доверяют друг другу.

Docker - Для каждого задания Runner запускает новый Docker-контейнер и выполняет команды внутри него. Уровень изоляции высокий (каждое задание в своем чистом контейнере). Подавляющее большинство случаев. Гарантирует чистоту и повторяемость сборок.

Kubernetes - Для каждого задания Runner создает новый Pod в кластере Kubernetes. Уровень изоляции очень высокий.Масштабируемые окружения, где инфраструктура уже построена на Kubernetes.

VirtualBox/Parallels. Запускает целую виртуальную машину для задания. Уровень изоляции полный (изоляция на уровне ОС). Специфические случаи, когда нужно тестировать под разные ОС (Windows, macOS, FreeBSD).



### ------------------- installation runner ------------------------

# direct installation on the server


# 1. Добавляем официальный репозиторий GitLab Runner
curl -L https://packages.gitlab.com/install/repositories/runner/gitlab-runner/script.deb.sh | sudo bash

# 2. Устанавливаем раннер
sudo apt-get install gitlab-runner

# 3. Проверяем, что установка прошла успешно
gitlab-runner --version


# installation runner in docker container
Раннер будет иметь доступ к сокету docker'a чтобы запускать другие контейнеры 

# Создаем директорию для конфига и запускаем контейнер
sudo docker run -d --name gitlab-runner --restart always \
  -v /srv/gitlab-runner/config:/etc/gitlab-runner \
  -v /var/run/docker.sock:/var/run/docker.sock \
  gitlab/gitlab-runner:latest




# Регистрация раннера 
После установки раннера, его нужно зарегестрировать в gitlab, чтобы они смогли общаться

- Зайди в свой GitLab, открой проект, для которого нужен раннер.

- Перейди: Settings → CI/CD → Runners.

- Нажми "New project runner" . Там же будет инструкция с нужными параметрами.

gitlab-runner register  --url http://192.168.0.109  --token glrt-t3_NNzPzBDsu95ZZ5R5xfsX

docker exec -it gitlab-runner gitlab-runner register  --url http://192.168.0.109  --token glrt-t3_NNzPzBDsu95ZZ5R5xfsX












## Как работает Docker Executor

Runner общается с Docker-демоном на своей машине. Он создает и запускает все необходимые служебные контейнеры, которые ты указал в секции services (например, postgres:latest или redis:latest)

Запускается специальный служебный контейнер (на базе Alpine Linux). Его задача — подготовить рабочее пространство: склонировать код из репозитория, восстановить кэш и скачать артефакты из предыдущих стадий.

Выполнение задания (Job). Это главный акт. Runner запускает контейнер из образа, который ты указал в директиве image (например, node:18). Он подключает к этому контейнеру папку с кодом, подготовленную на предыдущем шаге, и выполняет все команды из script.

Пост-задание (Post-job). Снова запускается служебный контейнер, чтобы сохранить кэш и загрузить артебефекты обратно в GitLab